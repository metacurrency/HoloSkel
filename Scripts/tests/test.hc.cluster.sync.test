testName=$1
successMessage=$2
failMessage=$3
scale=$4
grepStringList=$5


#take down network
docker-compose down
#rebuild all images
docker-compose build --no-cache
#set scale
echo "docker-compose scale hc=$scale"
docker-compose scale "hc=$scale"
#bring network up
echo "docker-compose -f ../../docker-compose.multiNodeSync.yml up | tee $2.output"
docker-compose -f ../../docker-compose.multiNodeSync.yml up | tee $2.output

#run tests and analyse output
grep -q "$grepStringList" ./$testName.output || {echo "failed: $failMessage" && exit 1; }

#remove extraneous files (log?)
rm ./$testName.output

#terminate test
echo "passed. $successMessage"
