testName=$1
successMessage=$2
failMessage=$3
scale=$4
grepStringList=$5


#take down network
docker-compose down
#rebuild all images
docker-compose build --no-cache
#set scale
echo "docker-compose scale hc=$scale"
docker-compose scale "hc=$scale"
export HC_SCALE=5
echo "exported HC_SCALE=$HC_SCALE. Check the source maintains where necessary"
#bring network up
echo "docker-compose -f ../../docker-compose.multiNodeSync.yml up | tee ./$testName.output"
docker-compose -f ../../docker-compose.multiNodeSync.yml up | tee ./$testName.output

#run tests and analyse output
grep -q "hv.post.up.Scripts.run" ./$testName.output || { echo "failed: $failMessage" && exit 1; }

#remove extraneous files (log?)
rm ./$testName.output

#terminate test
echo "passed. $successMessage"
