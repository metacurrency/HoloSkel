testName=$1
successMessage=$2
failMessage=$3
scale=$4
grepStringList=$5

dockerComposeFile="-f ../../docker-compose.multiNodeSync.yml"
export HC_SCALE=`ls ../../Scripts/cluster/hc -1 | wc -l`

#take down network
docker-compose $dockerComposeFile down
#rebuild all images
docker-compose $dockerComposeFile build --no-cache
#set scale
echo "docker-compose $dockerComposeFile scale hc=$scale"
docker-compose scale "hc=$HC_SCALE"
echo "exported HC_SCALE=$HC_SCALE. Check the source maintains where necessary"
#bring network up
echo "docker-compose $dockerComposeFile up | tee ./$testName.output"
docker-compose $dockerComposeFile up | tee ./$testName.output

#run tests and analyse output
grep -q "hc.post.up.Scripts.run" ./$testName.output || { echo "failed: $failMessage" && exit 1; }

#remove extraneous files (log?)
#rm ./$testName.output

#terminate test
echo "passed. $successMessage"
